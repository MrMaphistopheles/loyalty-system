"use client";

import { api } from "@/trpc/react";
import { Button, CircularProgress } from "@nextui-org/react";
import { QrScanner } from "@yudiel/react-qr-scanner";

type Data = {
  status: number;
};

export default function Scaner() {
  const { data, mutate, isLoading, isError } = api.waiter.scan.useMutation();

  let status: Data = data as Data;

  const update = (clientId: string) => {
    mutate({ clientId: clientId });
  };

  if (isLoading) {
    return <Loading color="stroke-blue-500" />;
  }
  if (isError) {
    return <div>server error</div>;
  }
  if (status && status.status === 200) {
    return <Gift />;
  }
  if (status && status.status === 201) {
    return <Counted />;
  }

  return (
    <div className="flex w-full flex-col items-center justify-center">
      <div className="flex w-10/12 flex-wrap overflow-hidden rounded-2xl md:max-w-[25rem]">
        <QrScanner
          onDecode={(result) => update(result)}
          scanDelay={2000}
          onError={(error) => console.log(error?.message)}
        />
      </div>
    </div>
  );
}

function Gift() {
  return (
    <div className="flex w-full flex-col items-center justify-center gap-4">
      <div className="flex w-full items-center justify-center p-12">
        <svg
          width="100%"
          height="100%"
          viewBox="0 0 244 320"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M31.7615 33.4326C28.8945 33.4324 26.0587 33.9558 23.4328 34.9698C20.807 35.9839 18.4482 37.4665 16.5056 39.3241C14.563 41.1817 13.0788 43.374 12.1465 45.7625C11.2141 48.151 10.8539 50.6838 11.0887 53.2011C32.2737 141.153 41.591 225.025 34.4157 303.224C34.8687 307.787 37.2397 312.037 41.0638 315.14C44.8878 318.243 49.8894 319.976 55.0885 320H188.911C194.11 319.976 199.112 318.243 202.936 315.14C206.76 312.037 209.131 307.787 209.584 303.224C198.773 224.347 210.205 140.128 232.911 53.2011C233.146 50.6838 232.786 48.151 231.853 45.7625C230.921 43.374 229.437 41.1817 227.494 39.3241C225.552 37.4665 223.193 35.9839 220.567 34.9698C217.941 33.9558 215.105 33.4324 212.238 33.4326H31.7615Z"
            fill="#6C63FF"
          />
          <path
            d="M243.588 66.5312L233.607 25.1402C232.699 21.3762 230.337 17.9992 226.916 15.5757C223.495 13.1521 219.223 11.8295 214.817 11.8295H152.51C152.266 11.1073 151.869 10.4315 151.339 9.83738L144.415 2.28193C143.763 1.56994 142.935 0.995169 141.994 0.600193C141.053 0.205217 140.022 2.43719e-06 138.977 1.98663e-10H100.506C99.4619 -7.37782e-06 98.4306 0.205217 97.4892 0.600193C96.5479 0.99517 95.7203 1.56994 95.0678 2.28193L88.1446 9.83738C87.6149 10.4315 87.2179 11.1073 86.9742 11.8295H29.1834C24.7776 11.8295 20.5056 13.1521 17.0843 15.5757C13.6631 17.9992 11.3003 21.3762 10.3926 25.1402L0.412029 66.5312C-0.176653 68.9722 -0.134106 71.4972 0.536941 73.922C1.20799 76.3468 2.49039 78.6104 4.29071 80.5475C6.09102 82.4847 8.36394 84.0467 10.9435 85.1196C13.5231 86.1925 16.3446 86.7492 19.2019 86.7492C86.1719 104.815 157.828 104.815 224.798 86.7492C227.655 86.7492 230.477 86.1924 233.056 85.1196C235.636 84.0467 237.909 82.4849 239.709 80.5477C241.509 78.6106 242.792 76.3471 243.463 73.9222C244.134 71.4974 244.177 68.9723 243.588 66.5312Z"
            fill="#3F3D56"
          />
          <path
            d="M210.878 166L30.9141 172L36.4344 219H205.358L210.878 166Z"
            fill="#B0ABFF"
          />
          <path
            opacity="0.2"
            d="M144.126 215.066C144.432 213.596 144.615 212.069 144.659 210.495L198.818 149.731L152.268 121.724L131.752 189.124C130.35 188.672 128.886 188.408 127.369 188.408C126.564 188.408 125.777 188.499 125.001 188.63L104.635 121.724L58.085 149.731L110.115 208.107C110.082 208.65 110.048 209.193 110.048 209.746C110.048 211.587 110.257 213.362 110.613 215.066C78.7194 227.345 65.6629 264.427 65.6629 264.427L105.718 304.438C103.329 275.007 117.918 244.876 125.805 230.988C126.321 231.045 126.841 231.085 127.369 231.085C127.897 231.085 128.417 231.045 128.933 230.988C136.82 244.876 151.409 275.007 149.02 304.438L189.075 264.427C189.075 264.427 176.019 227.345 144.126 215.066Z"
            fill="black"
          />
          <path
            d="M150.008 290.021C149.541 290.021 149.07 289.896 148.625 289.64C147.501 288.993 146.791 287.646 146.771 286.122C146.443 260.321 134.5 234.997 127.411 222.199C126.938 221.345 126.12 220.834 125.223 220.834H125.219C124.29 220.834 123.472 221.345 122.999 222.199C115.91 234.997 103.968 260.321 103.639 286.122C103.619 287.645 102.909 288.993 101.785 289.64C100.649 290.295 99.339 290.097 98.3666 289.126L65.0739 255.87C63.8856 254.682 63.5367 252.603 64.2447 250.923C67.6101 242.939 80.5663 216.029 105.994 204.963C107.128 204.469 107.817 203.077 107.669 201.578C107.586 200.74 107.545 199.899 107.545 199.078C107.546 198.099 107.243 197.209 106.711 196.613L58.8477 142.911C58.0539 142.021 57.671 140.707 57.8227 139.398C57.9748 138.089 58.6417 136.96 59.6064 136.379L99.4572 112.404C100.275 111.911 101.228 111.868 102.075 112.282C102.921 112.696 103.589 113.537 103.909 114.586L122.386 175.289C122.767 176.542 123.745 177.36 124.856 177.326C125.693 177.302 126.542 177.362 127.388 177.497C128.583 177.694 129.711 176.864 130.129 175.488L148.667 114.586C148.986 113.537 149.655 112.696 150.5 112.282C151.346 111.868 152.301 111.912 153.118 112.404L192.968 136.379C193.933 136.96 194.601 138.089 194.752 139.399C194.904 140.707 194.521 142.021 193.727 142.911L143.582 199.174C143.114 199.698 142.823 200.414 142.763 201.188C142.749 201.356 142.735 201.523 142.719 201.69C142.581 203.098 143.292 204.474 144.408 204.96C169.841 216.023 182.799 242.938 186.166 250.923C186.874 252.603 186.525 254.682 185.336 255.87L152.043 289.126C151.452 289.717 150.734 290.021 150.008 290.021Z"
            fill="#B0ABFF"
          />
        </svg>
      </div>
      <h1 className="text-xl dark:text-white">
        Клієнт отримує безкоштовну напій!
      </h1>
      <Button
        size="lg"
        className="w-2/3 bg-black text-white dark:bg-white dark:text-black"
        onClick={() => {
          window.location.reload();
        }}
      >
        Повернутися
      </Button>
    </div>
  );
}

function Counted() {
  return (
    <div className="flex w-full flex-col items-center justify-center gap-4">
      <div className="flex w-full items-center justify-center px-7">
        <svg
          width="100%"
          height="100%"
          viewBox="0 0 381 453"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M175.896 383.942C92.209 383.942 24.124 315.857 24.124 232.17C24.124 148.482 92.209 80.3975 175.896 80.3975C259.584 80.3975 327.669 148.482 327.669 232.17C327.669 315.857 259.584 383.942 175.896 383.942ZM175.896 83.3975C93.8633 83.3975 27.124 150.137 27.124 232.17C27.124 314.203 93.8633 380.942 175.896 380.942C257.93 380.942 324.669 314.203 324.669 232.17C324.669 150.137 257.93 83.3975 175.896 83.3975Z"
            fill="#6C63FF"
          />
          <path
            d="M155.396 310.38C152.801 310.38 150.242 309.775 147.921 308.615C145.6 307.454 143.581 305.768 142.025 303.692L101.028 249.029C99.7113 247.273 98.7531 245.275 98.2084 243.148C97.6637 241.022 97.5431 238.809 97.8536 236.636C98.1641 234.463 98.8996 232.372 100.018 230.483C101.136 228.595 102.616 226.945 104.372 225.628C106.128 224.311 108.127 223.352 110.253 222.808C112.379 222.263 114.592 222.142 116.765 222.453C118.938 222.763 121.029 223.499 122.918 224.617C124.807 225.736 126.457 227.215 127.774 228.971L154.595 264.731L223.482 161.401C225.943 157.715 229.766 155.157 234.112 154.289C238.458 153.422 242.97 154.315 246.658 156.773C250.345 159.232 252.905 163.053 253.776 167.399C254.646 171.744 253.755 176.257 251.299 179.946L169.306 302.936C167.823 305.16 165.828 306.996 163.489 308.291C161.149 309.585 158.534 310.299 155.861 310.374C155.706 310.377 155.551 310.38 155.396 310.38Z"
            fill="#6C63FF"
          />
          <path
            d="M330.721 91.2865C331.139 88.4135 328.13 85.5973 324 84.9964C319.87 84.3956 316.183 86.2374 315.765 89.1104C315.347 91.9834 318.356 94.7996 322.486 95.4005C326.616 96.0014 330.303 94.1595 330.721 91.2865Z"
            fill="#E6E6E6"
          />
          <path
            d="M379.892 86.4887C380.31 83.6157 377.301 80.7995 373.171 80.1987C369.041 79.5978 365.355 81.4397 364.937 84.3126C364.519 87.1856 367.528 90.0018 371.658 90.6027C375.788 91.2035 379.474 89.3617 379.892 86.4887Z"
            fill="#3F3D56"
          />
          <path
            d="M317.256 51.4788C317.674 48.6058 314.665 45.7897 310.535 45.1888C306.405 44.5879 302.718 46.4298 302.3 49.3028C301.882 52.1758 304.891 54.992 309.021 55.5929C313.151 56.1938 316.838 54.3518 317.256 51.4788Z"
            fill="#FF6584"
          />
          <path
            d="M295.89 35.172C295.91 32.5345 294.439 30.3851 292.604 30.3712C290.77 30.3573 289.266 32.4842 289.246 35.1218C289.226 37.7593 290.697 39.9087 292.532 39.9226C294.367 39.9365 295.871 37.8096 295.89 35.172Z"
            fill="#E6E6E6"
          />
          <path
            d="M288.644 4.80093C288.664 2.1634 287.193 0.0140009 285.358 0.000126542C283.523 -0.0137478 282.02 2.11315 282 4.75069C281.98 7.38822 283.451 9.53761 285.286 9.55149C287.121 9.56536 288.624 7.43846 288.644 4.80093Z"
            fill="#3F3D56"
          />
          <path
            d="M344.99 58.2531C345.01 55.6155 343.538 53.4661 341.704 53.4523C339.869 53.4384 338.365 55.5653 338.345 58.2028C338.325 60.8404 339.796 62.9898 341.631 63.0036C343.466 63.0175 344.97 60.8906 344.99 58.2531Z"
            fill="#E6E6E6"
          />
          <path
            d="M321.228 70.1164C321.248 67.4789 319.777 65.3295 317.942 65.3156C316.107 65.3017 314.603 67.4286 314.583 70.0662C314.564 72.7037 316.035 74.853 317.87 74.8669C319.704 74.8808 321.208 72.754 321.228 70.1164Z"
            fill="#FF6584"
          />
          <path
            d="M354.305 92.0442C354.325 89.4066 352.854 87.2572 351.019 87.2434C349.184 87.2295 347.681 89.3564 347.661 91.9939C347.641 94.6314 349.112 96.7808 350.947 96.7947C352.782 96.8085 354.285 94.6817 354.305 92.0442Z"
            fill="#3F3D56"
          />
          <path
            d="M48.721 447.286C49.1391 444.413 46.1299 441.597 42 440.996C37.87 440.396 34.1832 442.237 33.7652 445.11C33.3472 447.983 36.3563 450.8 40.4862 451.401C44.6161 452.001 48.303 450.16 48.721 447.286Z"
            fill="#E6E6E6"
          />
          <path
            d="M97.8929 442.489C98.3109 439.616 95.3018 436.799 91.1718 436.199C87.0419 435.598 83.3551 437.44 82.9371 440.313C82.519 443.186 85.5281 446.002 89.6581 446.603C93.788 447.204 97.4749 445.362 97.8929 442.489Z"
            fill="#3F3D56"
          />
          <path
            d="M35.2567 407.479C35.6747 404.606 32.6656 401.79 28.5356 401.189C24.4057 400.588 20.7188 402.43 20.3008 405.303C19.8828 408.176 22.8919 410.992 27.0219 411.593C31.1518 412.194 34.8386 410.352 35.2567 407.479Z"
            fill="#FF6584"
          />
          <path
            d="M13.8905 391.172C13.9105 388.534 12.4392 386.385 10.6044 386.371C8.76961 386.357 7.26602 388.484 7.24607 391.122C7.22613 393.759 8.69739 395.909 10.5322 395.923C12.367 395.936 13.8706 393.81 13.8905 391.172Z"
            fill="#E6E6E6"
          />
          <path
            d="M6.64487 360.801C6.66481 358.163 5.19358 356.014 3.35878 356C1.52398 355.986 0.0204126 358.113 0.000468134 360.751C-0.0194763 363.388 1.45175 365.538 3.28656 365.551C5.12136 365.565 6.62493 363.438 6.64487 360.801Z"
            fill="#3F3D56"
          />
          <path
            d="M62.9896 414.253C63.0095 411.616 61.5383 409.466 59.7035 409.452C57.8687 409.438 56.3651 411.565 56.3452 414.203C56.3253 416.84 57.7964 418.99 59.6313 419.004C61.4661 419.018 62.9697 416.891 62.9896 414.253Z"
            fill="#E6E6E6"
          />
          <path
            d="M39.2279 426.116C39.2479 423.479 37.7766 421.329 35.9418 421.316C34.107 421.302 32.6034 423.429 32.5835 426.066C32.5635 428.704 34.0348 430.853 35.8696 430.867C37.7044 430.881 39.208 428.754 39.2279 426.116Z"
            fill="#FF6584"
          />
          <path
            d="M72.305 448.044C72.325 445.407 70.8537 443.257 69.0189 443.243C67.1841 443.229 65.6806 445.356 65.6606 447.994C65.6407 450.631 67.1119 452.781 68.9467 452.795C70.7815 452.809 72.2851 450.682 72.305 448.044Z"
            fill="#3F3D56"
          />
        </svg>
      </div>
      <h1 className="text-xl dark:text-white">Покупка зарахована!</h1>
      <Button
        size="lg"
        className="w-2/3 bg-black text-white dark:bg-white dark:text-black"
        onClick={() => {
          window.location.reload();
        }}
      >
        Повернутися
      </Button>
    </div>
  );
}

export function Loading({
  color,
}: {
  color?: "stroke-blue-500" | "stroke-black" | "stroke-white";
}) {
  return (
    <div className="flex items-center justify-center">
      <CircularProgress
        classNames={{
          svg: "w-14 h-14",
          indicator: `${color}`,
          track: `${color}/10`,
        }}
      />
    </div>
  );
}
